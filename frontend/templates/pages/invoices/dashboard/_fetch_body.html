{% load humanize %}
{% load mathfilters %}
<tbody id="table_body">
{% for invoice in invoices %}
    <tr>
        <td>{{ invoice.id }}</td>
        <td>
            {{ invoice.date_due | date:"d/m/Y" }}
        </td>
        <td>
            <div class="flex items-center text-sm">
                <div>
                    {% with cli_name=invoice.client_to.name|default:invoice.client_name %}
                        {% if cli_name %}
                            <p class="font-semibold">{{ cli_name }}</p>
                        {% else %}
                            <p class="font-thin">No Client</p>
                        {% endif %}
                    {% endwith %}
                </div>
            </div>
        </td>
        <td>
            Â£{{ invoice.get_total_price | floatformat:2 | intcomma }}
        </td>
        <td>
        <span class="badge badge-square rounded
        {% if invoice.payment_status == "sent" %}
        badge-outline text-gray-400 border-gray-600
        {% elif invoice.payment_status == "seen" %}
        badge-outline text-white border-white
        {% else %}
        badge-outline-success
        {% endif %}
">
         {{ invoice.payment_status | default:"sent" | title }}
        </span>
        </td>
        <td colspan="2">
            {# The if statement for dropdown top goes as followes #}
            {# Use dropdown on top if these: #}
            {# - is second to last item (and not first item) #}
            {# - is last item           (and not first item) #}
            <div class="dropdown dropdown-left
{% if forloop.last and invoices.count > 1 or forloop.counter == invoices.count|sub:1 and not forloop.first %}dropdown-top
{% endif %}">
                <label tabindex="0" class="btn btn-primary btn-outline btn-sm">
                    <i class="fa-solid fa-regular fa-ellipsis-vertical"></i>
                </label>
                <ul tabindex="0" class="dropdown-content z-[1] menu wp-2 shadow-2xl bg-base-200 rounded-box w-52">
                    <li>
                        <a href="{% url "invoices dashboard preview" id=invoice.id %}">
                            <i class="fa-solid fa-regular fa-file-pdf"></i>
                            Preview
                        </a>
                    </li>
                    <li>
                        <a href="{% url "invoices dashboard manage_access" id=invoice.id %}">
                            <i class="fa-solid fa-key"></i>
                            Manage Access
                        </a>
                    </li>
                    <div class="tooltip tooltip-left" data-tip="These actions aren't yet added.">
                        <li class="disabled">
                            <a href="">
                                <i class="fa-solid fa-regular fa-pencil"></i>
                                Edit
                            </a>
                        </li>
                        <li class="disabled">
                            <a href="">
                                <i class="fa-solid fa-trash"></i>
                                Delete
                            </a>
                        </li>
                    </div>
                </ul>
            </div>
            {#            <div class="flex flex-wrap gap-2">#}
            {#                <div class="relative flex group tooltip tooltip-top" data-tooltip="Preview">#}
            {#                    <a class="btn btn-primary btn-sm" href="{% url "invoices dashboard preview" id=invoice.id %}">#}
            {#                        <i class="fa fa-solid fa-regular fa-file-pdf"></i>#}
            {#                    </a>#}
            {#                </div>#}
            {#                <div class="relative flex group tooltip tooltip-top" data-tooltip="Edit">#}
            {#                    <button class="btn btn-success btn-sm" disabled>#}
            {#                        <i class="fa fa-solid fa-regular fa-pencil"></i>#}
            {#                    </button>#}
            {#                </div>#}
            {#                <div class="relative flex group tooltip tooltip-top" data-tooltip="Delete">#}
            {#                    <button class="btn btn-error btn-sm" disabled>#}
            {#                        <i class="fa-solid fa-trash"></i>#}
            {#                    </button>#}
            {#                </div>#}
            {#            </div>#}
        </td>
    </tr>
{% endfor %}
</tbody>

{% if sort %}
    <div hx-swap-oob="innerHTML:#sort_{{ sort }}">
        {% if sort == "payment_status" %}
            <i class="fa fa-solid fa-sort"></i>
            Payment Status
        {% elif sort == "date" %}
            <i class="fa fa-solid fa-sort"></i>
            Date
        {% endif %}
    </div>
{% endif %}
{% if filtering == "payment_status" %}
    {% for filter in all_filters %}
        <div hx-swap-oob="innerHTML:#filtering_{{ filter }}">
            {% if filter in selected_filters %}<i class="fa fa-solid fa-check"></i>{% endif %}
            {{ filter | title }}
        </div>
    {% endfor %}
{% endif %}

{% if filtering == "payment_status" %}
    <div hx-swap-oob="innerHTML:#filter_list_payment_status">
        <input type="hidden" name="payment_status_paid" value="{% if 'paid' in selected_filters %}true{% endif %}">
        <input type="hidden" name="payment_status_pending" value="{% if 'pending' in selected_filters %}true{% endif %}">
        <input type="hidden" name="payment_status_overdue" value="{% if 'overdue' in selected_filters %}true{% endif %}">
    </div>
{% endif %}
